<!DOCTYPE html>
<html ng-app="RSSFeedApp">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>NowU Feed Reader</title>
    <script type='text/javascript' src="//code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/angular.js/1.1.1/angular.min.js'></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css">
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <style type='text/css'>
        @import url(http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700);

        * {
            font-family: roboto,arial,helvetica;
        }

        .small {
            font-size: 11px;
        }
    </style>
    <script type='text/javascript'>
        //<![CDATA[

        'use strict';

        var App = angular.module('RSSFeedApp', []);

        App.controller("FeedCtrl", ['$scope', 'FeedService', function ($scope, Feed) {
            $scope.loadButonText = "Load";
            $scope.loadFeed = function (e) {
                Feed.parseFeed($scope.feedSrc).then(function (res) {
                    $scope.loadButonText = angular.element(e.target).text();
                    $scope.feeds = res.data.responseData.feed.entries;
                });
                $scope.selected = [];
                var updateSelected = function (action, id) {
                    if (action == 'add' & $scope.selected.indexOf(id) == -1) $scope.selected.push(id);
                    if (action == 'remove' && $scope.selected.indexOf(id) != -1) $scope.selected.splice($scope.selected.indexOf(id), 1);
                };

                $scope.updateSelection = function ($event, id) {
                    var checkbox = $event.target;
                    var action = (checkbox.checked ? 'add' : 'remove');
                    updateSelected(action, id);
                };

                $scope.selectAll = function ($event) {
                    var checkbox = $event.target;
                    var action = (checkbox.checked ? 'add' : 'remove');
                    for (var i = 0; i < $scope.assetResults.length; i++) {
                        var item = $scope.feeds[i];
                        updateSelected(action, item.id);
                    }
                };

                $scope.getSelectedClass = function (feed) {
                    return $scope.isSelected(feed.id) ? 'selected' : '';
                };

                $scope.isSelected = function (id) {
                    return $scope.selected.indexOf(id) >= 0;
                };

                //something extra I couldn't resist adding :)
                $scope.isSelectedAll = function () {
                    return $scope.selected.length === $scope.feeds.length;
                };
            };


        }]);

        App.factory('FeedService', ['$http', function ($http) {
            return {
                parseFeed: function (url) {
                    return $http.jsonp('//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=50&callback=JSON_CALLBACK&q=' + encodeURIComponent(url));
                }
            };
        }]);



        //]]>
    </script>


</head>
<body>
    <div class="container-fluid">
        <div data-ng-controller="FeedCtrl">
            <div class="row-fluid">
                <h4>Feed Reader</h4>
                <form>
                    <div class="input-prepend span12">
                        <div class="btn-group">
                            <button class="btn btn-info" type="button" tabindex="-1">{{loadButonText}}</button>
                            <button class="btn btn-info dropdown-toggle" data-toggle="dropdown" tabindex="-1">
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a href="#" ng-click="feedSrc='http://www.fool.com/feeds/headlines.aspx?p=gannett&s=eptgntlnk0000001&f=true&k=0BmoHoFtZlnPv44Yl14r1w';loadFeed($event);">Motley Fool (Gannett)</a></li>
                                <li><a href="#" ng-click="feedSrc='http://www.fool.com/feeds/headlines.aspx?id=foolwatch';loadFeed($event);">Motley Fool</a></li>
                                <li><a href="#" ng-click="feedSrc='http://news.ycombinator.com/rss';loadFeed($event)">Hacker News</a></li>
                                <li><a href="#" ng-click="feedSrc='http://feeds2.feedburner.com/Mashable';loadFeed($event)">Mashable</a></li>
                                <li><a href="#" ng-click="feedSrc='http://feeds.huffingtonpost.com/huffingtonpost/raw_feed';loadFeed($event)">Huffington Post</a></li>
                                <li><a href="#" ng-click="feedSrc='http://feeds.feedburner.com/TechCrunch';loadFeed($event)">TechCrunch</a></li>
                            </ul>
                        </div>
                        <input type="text" class="span10" autocomplete="off" placeholder="Enter Feed URL" data-ng-model="feedSrc" />
                    </div>
                    <div class="input-prepend">
                        <span class="add-on"><i class=" icon-search"></i></span>count
                        <input class="span12" type="text" data-ng-model="filterText" />
                    </div>
                </form>
            </div>
            <table id="resultsTbl" class="table table-striped" ng-controller="FeedCtrl">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" ng-click="selectAll($event)" ng-checked="isSelectedAll()" />
                        </th>
                        <th>Title</th>
                        <th>Snippet</th>
                        <th>Pub Date</th>
                        <th>Author</th>
                    </tr>
                </thead>
                <tbody>
                    <div class="row-fluid">
                        <ul class="unstyled" />
                        <span class="badge badge-warning" ng-show="feeds.length > 0">{{(feeds | filter:filterText).length}} Items</span>
                        <tr ng-repeat="feed in feeds | filter:filterText" ng-class="getSelectedClass(feed.id)">
                            <td><input type="checkbox" name="selected" ng-checked="isSelectedAll(feed.id)" ng-click="updateSelection($event, feed.id)"></td>
                            <td><a target="_blank" href="{{feed.link}}">{{feed.title}}</a></td>
                            <td><span class="text-left">{{feed.contentSnippet}}</span></td>
                            <td><span class="small">{{feed.publishedDate}}</span></td>
                            <td><span class="small">{{feed.author}}</span></td>
                        </tr>
                    </div>
                </tbody>
            </table>
        </div>
    </div>

</body>
</html>